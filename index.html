<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ôº°ÔΩêÔΩêÔΩì‚Åµ‚Å∞Ôºô | Connexion Google</title>

<style>
body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:linear-gradient(135deg,#000,#2c2c2c);
  color:#fff;
}
header{
  background:rgba(0,0,0,0.7);
  padding:20px;
  text-align:center;
  border-bottom:1px solid rgba(255,255,255,0.15);
}
header h1{
  margin:0;
  font-size:2rem;
  background:linear-gradient(90deg,#fff,#aaa);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.container{
  max-width:420px;
  margin:40px auto;
  background:rgba(255,255,255,0.08);
  border-radius:18px;
  padding:25px;
  box-shadow:0 0 25px rgba(0,170,255,0.25);
  text-align:center;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:#00aaff;
  color:#000;
  font-size:1rem;
  font-weight:bold;
  cursor:pointer;
  transition:0.25s;
}
button:hover{
  background:#FFD700;
  box-shadow:0 0 15px #FFD700aa;
}
footer{
  text-align:center;
  margin-top:30px;
  font-size:0.85rem;
  color:#aaa;
}
</style>
</head>

<body>

<header>
  <h1>Ôº°ÔΩêÔΩêÔΩì‚Åµ‚Å∞Ôºô</h1>
  <p>Connexion s√©curis√©e avec Google</p>
</header>

<div class="container">
  <button id="googleLoginBtn">üîê Se connecter avec Google</button>
</div>

<footer>¬© 2025 ‚Äî Ôº°ÔΩêÔΩêÔΩì‚Åµ‚Å∞Ôºô</footer>

<!-- Firebase (MODULE VERSION) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* üî• CONFIG FIREBASE ‚Äî TON PROJET */
const firebaseConfig = {
  apiKey: "AIzaSyAm1-53K6VuK7wdwu67pUjLU3t7S_-bwJo",
  authDomain: "app509-d7bc6.firebaseapp.com",
  projectId: "app509-d7bc6",
  storageBucket: "app509-d7bc6.firebasestorage.app",
  messagingSenderId: "1139351082",
  appId: "1:1139351082:web:18461a1249b189ef7eed53"
};

/* INIT */
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

/* LOGIN GOOGLE */
document.getElementById("googleLoginBtn").onclick = async () => {
  try{
    const result = await signInWithPopup(auth, provider);
    const user = result.user;

    const userRef = doc(db,"users",user.uid);
    const snap = await getDoc(userRef);

    /* Cr√©er le compte s‚Äôil n‚Äôexiste pas */
    if(!snap.exists()){
      await setDoc(userRef,{
        fullname: user.displayName,
        email: user.email,
        role: "user",      // admin / user (par d√©faut user)
        photo: user.photoURL,
        createdAt: serverTimestamp(),
        lastLogin: serverTimestamp()
      });
    }else{
      await setDoc(userRef,{
        lastLogin: serverTimestamp()
      },{ merge:true });
    }

    /* Session */
    sessionStorage.setItem("dpstore_user", JSON.stringify({
      fullname: user.displayName,
      email: user.email,
      role: snap.exists() ? snap.data().role : "user",
      photo: user.photoURL
    }));

    /* REDIRECTION */
    window.location.href = "profil.html";

  }catch(e){
    alert("‚ùå Erreur connexion Google : " + e.message);
  }
};
</script>

</body>
</html>
