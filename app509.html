<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ï¼¡ï½ï½ï½“âµâ°ï¼™ | Formulaire</title>

<style>
/* ton CSS existant */
body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:linear-gradient(135deg,#000,#2c2c2c);
  color:#fff;
}
/* reste du CSS inchangÃ© */
</style>
</head>

<body>

<header>
  <h1>ï¼¡ï½ï½ï½“âµâ°ï¼™</h1>
</header>

<div class="container">
<form id="apps509Form">

<!-- ===== COMPTE ===== -->
<div class="form-section">
  <div class="form-title">Compte</div>

  <label>Nom du compte actuel</label>
  <input type="text" id="currentAccount">

  <div class="status compact">
    <input type="checkbox" checked id="accountActive">
    <label for="accountActive">Compte actif</label>
  </div>
</div>

<!-- ===== IDENTITÃ‰ ===== -->
<div class="form-section">
  <div class="form-title">IdentitÃ©</div>

  <label>Nom complet</label>
  <input type="text" id="fullnameInput" required placeholder="Nom et prÃ©nom">

  <label>Genre</label>
  <div class="gender-box">
    <div class="gender-btn active" data-gender="â™‚" onclick="setGender(this)">â™‚</div>
    <div class="gender-btn" data-gender="â™€" onclick="setGender(this)">â™€</div>
  </div>
  <input type="hidden" id="gender" value="â™‚">
</div>

<!-- ===== CONTACT ===== -->
<div class="form-section">
  <div class="form-title">Contact</div>

  <label>Email</label>
  <input type="email" id="emailInput" required placeholder="email@example.com">

  <label>TÃ©lÃ©phone</label>
  <div class="phone-box">
    <select id="phonePrefix">
      <option value="+509">ğŸ‡­ğŸ‡¹ +509</option>
      <option value="+1">ğŸ‡ºğŸ‡¸ +1</option>
      <option value="+33">ğŸ‡«ğŸ‡· +33</option>
      <option value="+44">ğŸ‡¬ğŸ‡§ +44</option>
    </select>
    <input type="tel" id="phoneNumber" placeholder="NumÃ©ro">
  </div>
</div>

<!-- ===== JEU ===== -->
<div class="form-section">
  <div class="form-title">Jeu</div>

  <label>UID du joueur</label>
  <input type="text" id="playerUID" placeholder="UID / ID du joueur">

  <label>RÃ©gion</label>
  <select id="playerRegion">
    <option value="amerique-nord">AmÃ©rique du Nord</option>
    <option value="amerique-sud">AmÃ©rique du Sud</option>
    <option value="europe">Europe</option>
    <option value="mena">MENA</option>
  </select>

  <label>Niveau du compte</label>
  <select id="playerLevel">
    <script>
      for(let i=1;i<=120;i++){
        document.write(`<option value="${i}">${i}</option>`);
      }
    </script>
  </select>
</div>

<!-- ===== CRÃ‰ATEUR ===== -->
<div class="form-section creator-section">
  <div class="form-title">CrÃ©ateur de contenu</div>

  <div class="status">
    <input type="checkbox" id="isCreator" onchange="toggleCreator()">
    <label for="isCreator">Activer</label>
  </div>

  <div id="creatorLinkBox">
    <label>RÃ©seau social</label>
    <div class="network-btns">
      <div class="network-btn active" data-network="tiktok" onclick="setNetwork(this)">
        <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/tiktok.svg" width="20"> TikTok
      </div>
      <div class="network-btn" data-network="youtube" onclick="setNetwork(this)">
        <img src="https://upload.wikimedia.org/wikipedia/commons/b/b8/YouTube_Logo_2017.svg" width="20"> YouTube
      </div>
      <div class="network-btn" data-network="instagram" onclick="setNetwork(this)">
        <img src="https://upload.wikimedia.org/wikipedia/commons/e/e7/Instagram_logo_2016.svg" width="20"> Instagram
      </div>
      <div class="network-btn" data-network="twitch" onclick="setNetwork(this)">
        <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/twitch.svg" width="20"> Twitch
      </div>
      <div class="network-btn" data-network="facebook" onclick="setNetwork(this)">
        <img src="https://upload.wikimedia.org/wikipedia/commons/0/05/Facebook_Logo_(2019).png" width="20"> Facebook
      </div>
    </div>
    <input type="hidden" id="creatorNetworkValue" value="tiktok">

    <label>Lien du profil</label>
    <input type="url" id="creatorLink" placeholder="https://">
  </div>
</div>

<!-- ===== MESSAGE ===== -->
<div class="form-section">
  <div class="form-title">Message</div>

  <textarea rows="4" id="messageInput" placeholder="Informations supplÃ©mentaires"></textarea>
</div>

<button type="submit">Envoyer</button>

</form>
</div>

<footer>Â© 2025 â€” ï¼¡ï½ï½ï½“âµâ°ï¼™</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ğŸ”¥ Firebase config */
const firebaseConfig = {
  apiKey: "AIzaSyAufnNEFHPZLbMK-gwYotj4VB1bqBXw8l4",
  authDomain: "app509cloud.firebaseapp.com",
  projectId: "app509cloud",
  storageBucket: "app509cloud.firebasestorage.app",
  messagingSenderId: "445508086674",
  appId: "1:445508086674:web:22d593d940bd328d436f4b"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* VÃ©rifier connexion */
onAuthStateChanged(auth, (user) => {
  if(!user){
    location.href = "index.html";
  } else {
    // PrÃ©remplir
    document.getElementById("fullnameInput").value = user.displayName || "";
    document.getElementById("emailInput").value = user.email || "";

    sessionStorage.setItem("dpstore_user", JSON.stringify({
      fullname: user.displayName || "",
      email: user.email,
      photo: user.photoURL || ""
    }));
  }
});

/* Nom du compte auto */
let currentUser = JSON.parse(sessionStorage.getItem("dpstore_user") || "{}");
if(currentUser.username){
  document.getElementById("currentAccount").value = currentUser.username;
}

/* Genre */
function setGender(el){
  document.querySelectorAll(".gender-btn").forEach(b => b.classList.remove("active"));
  el.classList.add("active");
  document.getElementById("gender").value = el.getAttribute("data-gender");
}

/* CrÃ©ateur */
function toggleCreator(){
  document.getElementById("creatorLinkBox").style.display =
    document.getElementById("isCreator").checked ? "block" : "none";
}

/* RÃ©seau social avec icÃ´ne */
function setNetwork(el){
  document.querySelectorAll(".network-btn").forEach(b=>b.classList.remove("active"));
  el.classList.add("active");
  document.getElementById("creatorNetworkValue").value = el.getAttribute("data-network");
}

/* ===== Soumettre formulaire dans Firestore ===== */
document.getElementById("apps509Form").addEventListener("submit", async e=>{
  e.preventDefault();

  const formData = {
    currentAccount: document.getElementById("currentAccount").value,
    fullname: document.getElementById("fullnameInput").value,
    gender: document.getElementById("gender").value,
    email: document.getElementById("emailInput").value,
    phone: document.getElementById("phonePrefix").value + " " + document.getElementById("phoneNumber").value,
    playerUID: document.getElementById("playerUID").value,
    playerRegion: document.getElementById("playerRegion").value,
    playerLevel: document.getElementById("playerLevel").value,
    isCreator: document.getElementById("isCreator").checked,
    creatorNetwork: document.getElementById("creatorNetworkValue").value,
    creatorLink: document.getElementById("creatorLink").value,
    message: document.getElementById("messageInput").value,
    createdAt: serverTimestamp()
  };

  try{
    await addDoc(collection(db,"forms"), formData);
    alert("âœ… Formulaire envoyÃ© avec succÃ¨s !");
    e.target.reset();
    toggleCreator(); // cacher les champs crÃ©ateur si nÃ©cessaire
  } catch(err){
    alert("âŒ Erreur lors de l'envoi : " + err.message);
  }
});
</script>

</body>
</html>
